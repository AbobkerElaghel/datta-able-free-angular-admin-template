"use strict";(self.webpackChunkdatta_able_free_angular_admin_template=self.webpackChunkdatta_able_free_angular_admin_template||[]).push([[3676],{3676:(M,h,r)=>{r.r(h),r.d(h,{EmployeeEvaluationPersonnelAffairsConfirmationModule:()=>w});var p=r(177),u=r(9417),y=r(1786),g=r(9947),v=r(4823),C=r(9631),m=r(8834),e=r(3953),d=r(1626),f=r(1441);let D=(()=>{class t{constructor(a,o){this.http=a,this.appConfig=o,this.url=this.appConfig.defaultUrl}static#e=this.\u0275fac=function(o){return new(o||t)(e.KVO(d.Qq),e.KVO(f.o))};static#a=this.\u0275prov=e.jDH({token:t,factory:t.\u0275fac})}return t})();var T=r(1413),A=r(8141),G=r(6496),E=r(3471),k=r(3197),j=r(8655);let F=(()=>{class t{constructor(a,o){this.sharedFacade=a,this.employeeGlobalServices=o,this.selectedEmployeeSubject$=new T.B,this.selectedEmployee$=this.selectedEmployeeSubject$.asObservable()}GetEmployeeByCode(a){const o=this.employeeGlobalServices.GetEmployee("1",a).pipe((0,A.M)(n=>{n.type==E.yl.Success?this.selectedEmployeeSubject$.next(n.content[0]):(this.selectedEmployeeSubject$.next(null),this.sharedFacade.showMessage(E.Go.error,"\u062e\u0637\u0623 \u0641\u064a \u0639\u0645\u0644\u064a\u0629 \u062c\u0644\u0628 \u0627\u0644\u0645\u0648\u0638\u0641",n.messages))}),(0,G.t)());this.sharedFacade.showLoaderUntilCompleted(o).pipe().subscribe()}static#e=this.\u0275fac=function(o){return new(o||t)(e.KVO(k.I),e.KVO(j.U))};static#a=this.\u0275prov=e.jDH({token:t,factory:t.\u0275fac})}return t})();var b=r(7062),I=r(4572),N=r(9783),S=r(3507),$=r(2016),R=r(2702),L=r(4249),O=r(3805);const x=t=>({"is-invalid":t}),P=()=>[2021,2022,2023,2024];function Y(t,c){1&t&&(e.j41(0,"div",18),e.EFF(1," \u0627\u0644\u0631\u062c\u0627\u0621 \u0627\u062e\u062a\u064a\u0627\u0631 \u0645\u0648\u0638\u0641. "),e.k0s())}function U(t,c){if(1&t&&(e.j41(0,"option",19),e.EFF(1),e.k0s()),2&t){const a=c.$implicit;e.Y8G("value",a),e.R7$(),e.JRh(a)}}function V(t,c){1&t&&(e.j41(0,"div",18),e.EFF(1," \u0627\u0644\u0631\u062c\u0627\u0621 \u0627\u062e\u062a\u064a\u0627\u0631 \u0627\u0644\u0633\u0646\u0629. "),e.k0s())}function H(t,c){1&t&&(e.j41(0,"div"),e.EFF(1,"\u0644\u0627 \u064a\u0648\u062c\u062f \u062a\u0642\u064a\u0645 \u0644\u0647\u0630\u0629 \u0627\u0644\u0645\u0648\u0638\u0641 \u0644\u0647\u0630\u0629 \u0627\u0644\u0633\u0646\u0629"),e.k0s())}function B(t,c){if(1&t&&(e.j41(0,"div",20),e.nrm(1,"hr"),e.j41(2,"div")(3,"div"),e.EFF(4),e.k0s()(),e.DNE(5,H,2,0,"div",21),e.k0s()),2&t){let a;const o=e.XpG();e.R7$(4),e.SpI("\u0627\u0644\u0645\u0648\u0638\u0641 | ",null==(a=o.evaluationForm.get("employee"))||null==a.value?null:a.value.name,""),e.R7$(),e.Y8G("ngIf",!o.evaluationId)}}function K(t,c){if(1&t&&(e.j41(0,"div",24)(1,"app-card",25)(2,"div",26),e.nrm(3,"input",27),e.j41(4,"label",28),e.EFF(5,"\u0627\u0644\u0631\u0626\u064a\u0633 \u0627\u0644\u0645\u0628\u0627\u0634\u0631"),e.k0s()(),e.j41(6,"div",29),e.nrm(7,"input",30),e.j41(8,"label",31),e.EFF(9,"\u0627\u0644\u0631\u0626\u064a\u0633 \u0627\u0644\u0623\u0639\u0644\u0649"),e.k0s()(),e.j41(10,"div",32),e.nrm(11,"input",33),e.j41(12,"label",34),e.EFF(13,"\u0645\u062f\u064a\u0631 \u0627\u0644\u0625\u062f\u0627\u0631\u0629"),e.k0s()(),e.nrm(14,"hr",35),e.j41(15,"div",36),e.nrm(16,"input",37),e.j41(17,"label",38),e.EFF(18,"\u0634\u0624\u0648\u0646 \u0627\u0644\u0639\u0627\u0645\u0644\u064a\u0646"),e.k0s()(),e.j41(19,"div",39)(20,"h5"),e.EFF(21,"\u0627\u0644\u0645\u062c\u0645\u0648\u0639 \u0627\u0644\u0643\u0644\u064a"),e.k0s(),e.j41(22,"div",40),e.nrm(23,"input",41),e.nI1(24,"sumAllScores"),e.nrm(25,"input",41),e.nI1(26,"sumLargestScores"),e.k0s()()()()),2&t){const a=e.XpG(2);e.R7$(),e.Y8G("options",!1),e.R7$(22),e.Y8G("value",e.i5U(24,3,a.getFormArray(a.evaluationForm.get("evaluationScores")),"maxScore")),e.R7$(2),e.Y8G("value",e.bMT(26,6,a.getFormArray(a.evaluationForm.get("evaluationScores"))))}}function X(t,c){if(1&t&&(e.j41(0,"div",22),e.DNE(1,K,27,8,"div",23),e.k0s()),2&t){const a=e.XpG();e.R7$(),e.Y8G("ngIf",a.getFormArray(a.evaluationForm.get("evaluationScores")).length&&a.evaluationId)}}function J(t,c){if(1&t&&(e.j41(0,"button",42),e.EFF(1," \u062d\u0641\u0638 "),e.k0s()),2&t){const a=e.XpG();e.Y8G("disabled",!a.evaluationForm.valid||a.evaluationForm.untouched)}}const W=[{path:"",component:(()=>{class t{constructor(a,o,n,i){this.showEmployeeEvaluationTypeFacade=a,this.employeeEvaluationManagementFacade=o,this.employeeEvaluationPersonnelAffairsConfirmationFacade=n,this.fb=i}searchEmployeeByCode(a){this.evaluationForm.get("year")?.value&&a?this.employeeEvaluationPersonnelAffairsConfirmationFacade.GetEmployeeByCode(a):alert("\u0627\u0644\u0631\u062c\u0627\u0621 \u0625\u062f\u062e\u0627\u0644 \u0627\u0644\u0633\u0646\u0629 \u0648\u0631\u0642\u0645 \u0627\u0644\u0645\u0648\u0638\u0641")}ngOnInit(){this.showEmployeeEvaluationTypeFacade.fetchEmployeeEvaluationTypes(),this.employeeEvaluationPersonnelAffairsConfirmationFacade.selectedEmployee$.subscribe(a=>{const o=this.evaluationForm.get("year")?.value;a&&o&&(this.evaluationForm.get("employee").setValue({name:a.name,id:a.id}),this.employeeEvaluationManagementFacade.GetEmployeeEvaluation(a.id,o))}),this.evaluationForm=this.fb.group({employee:["",u.k0.required],evaluationType:["",u.k0.required],year:[null,u.k0.required],evaluationScores:this.fb.array([]),approvals:this.fb.group({DirectManager:this.fb.group({status:[{value:!1,disabled:!0},u.k0.required],approvedDate:[null]}),HigherLevelManager:this.fb.group({status:[{value:!1,disabled:!0},u.k0.required],approvedDate:[null]}),DepartmentManager:this.fb.group({status:[{value:!1,disabled:!0},u.k0.required],approvedDate:[null]}),PersonnelAffairs:this.fb.group({status:[{value:!1},u.k0.required],approvedDate:[null]})})}),(0,I.z)([this.employeeEvaluationManagementFacade.selectedEmployeeEvaluation$,this.employeeEvaluationTypes]).subscribe(([a,o])=>{let n=[];if(a&&o){const i=o.find(l=>l.id===a.evaluationScores.evaluationType.id);this.evaluationForm.get("evaluationType").setValue(i),n=a.evaluationScores.evaluationScores.map(l=>this.fb.group({evaluationItemName:[l.evaluationItemName,u.k0.required],evaluationItemType:[l.evaluationItemType,u.k0.required],scores:this.fb.array(l.scores.map(s=>this.fb.group({elementName:[s.elementName,u.k0.required],DirectManagerScore:[s.DirectManagerScore,this.getValidation(l.evaluationItemType,s.maxScore)],HigherLevelManagerScore:[s.HigherLevelManagerScore,this.getValidation(l.evaluationItemType,s.maxScore)],maxScore:[s.maxScore]})))})),this.evaluationForm.get("approvals").patchValue(a.evaluationScores.approvals),this.evaluationId=a.id}else this.evaluationId=void 0,this.evaluationForm.get("evaluationType").setValue(void 0),this.evaluationForm.get("approvals").patchValue({DirectManager:{status:!1,approvedDate:null},HigherLevelManager:{status:!1,approvedDate:null},DepartmentManager:{status:!1,approvedDate:null},PersonnelAffairs:{status:!1,approvedDate:null}});this.selectedEvaluationFormGroup=void 0,this.evaluationForm.setControl("evaluationScores",this.fb.array(n))})}get employeeEvaluationTypes(){return this.showEmployeeEvaluationTypeFacade.employeeEvaluationTypes$}get selectedEvalutionType(){return this.evaluationForm.get("evaluationType")?.value}onEvaluationTypeSelect(){const a=this.evaluationForm.get("evaluationType")?.value;if(!a)return;this.selectedEvaluationFormGroup=null;const o=a.evaluationData.EvaluationItems.map(n=>this.fb.group({evaluationItemName:[n.ItemName,u.k0.required],evaluationItemType:[n.type,u.k0.required],scores:this.fb.array(n.Elements.map(i=>this.fb.group({elementName:[i.ElementName,u.k0.required],DirectManagerScore:[0,this.getValidation(n.type,i.Value)],HigherLevelManagerScore:[0,this.getValidation(n.type,i.Value)],maxScore:[i.Value]})))}));this.evaluationForm.setControl("evaluationScores",this.fb.array(o||[]))}getValidation(a,o=1/0){return"Number"===a?[u.k0.required,u.k0.max(o),u.k0.min(0)]:"Text"===a?[u.k0.required]:"Range"===a?[u.k0.required,u.k0.pattern(/^\d+\s*-\s*\d+$/)]:[]}onSubmit(){if(this.evaluationForm.valid){this.evaluationForm.get("approvals").get("PersonnelAffairs").get("approvedDate").setValue(new Date);const a=this.evaluationForm.getRawValue();a.approvals.DirectManager.status&&a.approvals.DepartmentManager.status&&a.approvals.HigherLevelManager.status?this.addUpdateNewEvaluation(a):alert("\u062a\u0623\u0643\u062f \u0645\u0646 \u0645\u0648\u0627\u0641\u0642\u0629 \u062c\u0645\u064a\u0639 \u0627\u0644\u0623\u0637\u0631\u0627\u0641")}else alert("\u062a\u0623\u0643\u062f \u0645\u0646 \u0627\u0644\u0642\u064a\u0645 \u0627\u0644\u0645\u0637\u0644\u0648\u0628\u0629")}addUpdateNewEvaluation(a){const o=this.calculateTotalLargerScore(a)/this.sumEvaluationScores(a,"maxScore")*100,n={employeeId:a.employee.id,year:a.year,isApproved:this.getIsApprovedValue(a),totalScore:this.calculateTotalLargerScore(a),percentage:+o.toFixed(3),evaluationId:this.calculateEvaluationId(o),evaluationTypeId:a.evaluationType.id,evaluationDate:(new Date).toISOString(),evaluationScores:a};this.evaluationId&&this.employeeEvaluationManagementFacade.updateEmployeeEvaluation({...n,id:this.evaluationId})}getFormArray(a){return a}calculateTotalLargerScore(a){return a.evaluationScores.filter(o=>"Number"===o.evaluationItemType).reduce((o,n)=>o+n.scores.reduce((l,s)=>l+Math.max(s.DirectManagerScore,s.HigherLevelManagerScore),0),0)}getIsApprovedValue(a){return a.approvals.PersonnelAffairs.status?4:a.approvals.DepartmentManager.status?3:a.approvals.HigherLevelManager.status?2:a.approvals.DirectManager.status?1:0}sumEvaluationScores(a,o){return a&&a.evaluationScores?a.evaluationScores.filter(n=>"Number"===n.evaluationItemType).reduce((n,i)=>n+i.scores.reduce((l,s)=>l+(s[o]||0),0),0):0}calculateEvaluationId(a){return a>90?1:a>75?2:a>60?3:a>45?4:5}ngOnDestroy(){}static#e=this.\u0275fac=function(o){return new(o||t)(e.rXU(N.M),e.rXU(S.o),e.rXU(F),e.rXU(u.ok))};static#a=this.\u0275cmp=e.VBU({type:t,selectors:[["employee-evaluation-personnel-affairs-confirmation"]],decls:26,vars:11,consts:[["employeeCode",""],[1,"row"],[1,"col-sm-12"],[1,"card"],[1,"card-body"],[3,"ngSubmit","formGroup"],[1,"form-group","row"],[1,"col-sm-4"],["for","employee",1,"form-label"],["type","text",1,"form-control","form-control-sm"],["class","invalid-feedback",4,"ngIf"],["for","year",1,"form-label"],["formControlName","year",1,"form-control",3,"ngClass"],[3,"value",4,"ngFor","ngForOf"],["type","button",1,"btn","btn-md","btn-themeNew","has-ripple",3,"click"],["class","my-3 fw-bold",4,"ngIf"],["class","form-group",4,"ngIf"],["type","submit","class","btn btn-md btn-themeAdd has-ripple",3,"disabled",4,"ngIf"],[1,"invalid-feedback"],[3,"value"],[1,"my-3","fw-bold"],[4,"ngIf"],[1,"form-group"],["formGroupName","approvals",4,"ngIf"],["formGroupName","approvals"],["form","","cardTitle","\u0627\u0644\u062a\u0642\u064a\u064a\u0645\u0627\u062a","blockClass","table-border-style",3,"options"],["formGroupName","DirectManager",1,"form-check"],["formControlName","status","type","checkbox","id","directManagerStatus",1,"form-check-input"],["for","directManagerStatus",1,"form-check-label"],["formGroupName","HigherLevelManager",1,"form-check"],["formControlName","status","type","checkbox","id","HigherLevelManagerStatus",1,"form-check-input"],["for","HigherLevelManagerStatus",1,"form-check-label"],["formGroupName","DepartmentManager",1,"form-check"],["formControlName","status","type","checkbox","id","DepartmentManagerStatus",1,"form-check-input"],["for","DepartmentManagerStatus",1,"form-check-label"],[1,"my-3"],["formGroupName","PersonnelAffairs",1,"form-check"],["formControlName","status","type","checkbox","id","personnelAffairsStatus",1,"form-check-input","fw-bold"],["for","personnelAffairsStatus",1,"form-check-label"],[1,"d-flex","gap-2","mt-4"],[1,"d-flex","gap-1"],["disabled","","type","number",3,"value"],["type","submit",1,"btn","btn-md","btn-themeAdd","has-ripple",3,"disabled"]],template:function(o,n){if(1&o){const i=e.RV6();e.j41(0,"div",1),e.nrm(1,"app-loading")(2,"app-messages"),e.j41(3,"div",2)(4,"div",3)(5,"div",4)(6,"form",5),e.bIt("ngSubmit",function(){return e.eBV(i),e.Njj(n.onSubmit())}),e.j41(7,"div",6)(8,"div",7)(9,"label",8),e.EFF(10,"\u0631\u0642\u0645 \u0627\u0644\u0645\u0648\u0638\u0641"),e.k0s(),e.nrm(11,"input",9,0),e.DNE(13,Y,2,0,"div",10),e.k0s(),e.j41(14,"div",7)(15,"label",11),e.EFF(16,"\u0627\u0644\u0633\u0646\u0629"),e.k0s(),e.j41(17,"select",12),e.DNE(18,U,2,2,"option",13),e.k0s(),e.DNE(19,V,2,0,"div",10),e.k0s()(),e.j41(20,"button",14),e.bIt("click",function(){e.eBV(i);const s=e.sdS(12);return e.Njj(n.searchEmployeeByCode(s.value))}),e.EFF(21,"\u064a\u062d\u062b"),e.k0s(),e.DNE(22,B,6,2,"div",15)(23,X,2,1,"div",16)(24,J,2,1,"button",17),e.k0s()()()(),e.nrm(25,"div",2),e.k0s()}2&o&&(e.R7$(6),e.Y8G("formGroup",n.evaluationForm),e.R7$(7),e.Y8G("ngIf",n.evaluationForm.get("employee").invalid&&n.evaluationForm.get("employee").touched),e.R7$(4),e.Y8G("ngClass",e.eq3(8,x,n.evaluationForm.get("year").invalid&&n.evaluationForm.get("year").touched)),e.R7$(),e.Y8G("ngForOf",e.lJ4(10,P)),e.R7$(),e.Y8G("ngIf",n.evaluationForm.get("year").invalid&&n.evaluationForm.get("year").touched),e.R7$(3),e.Y8G("ngIf",n.evaluationForm.get("employee").value),e.R7$(),e.Y8G("ngIf",n.selectedEvalutionType&&n.evaluationForm.get("employee").value),e.R7$(),e.Y8G("ngIf",n.evaluationForm.valid))},dependencies:[p.YU,p.Sq,p.bT,u.qT,u.xH,u.y7,u.Zm,u.wz,u.BC,u.cb,u.j4,u.JD,u.$R,$.q,R.y,g.i,L.m,O.V]})}return t})(),data:{breadcrumb:"\u0625\u062f\u0627\u0631\u0629 \u0645\u0633\u0626\u0648\u0644\u064a\u0646 \u0627\u0644\u062c\u0647\u0627\u062a \u0627\u0644\u062a\u0646\u0638\u064a\u0645\u064a\u0629"}}];let z=(()=>{class t{static#e=this.\u0275fac=function(o){return new(o||t)};static#a=this.\u0275mod=e.$C({type:t});static#t=this.\u0275inj=e.G2t({imports:[b.iI.forChild(W),b.iI]})}return t})();var Q=r(3391),Z=r(6881);let w=(()=>{class t{static#e=this.\u0275fac=function(o){return new(o||t)};static#a=this.\u0275mod=e.$C({type:t});static#t=this.\u0275inj=e.G2t({providers:[D,F,Z.E,S.o],imports:[p.MD,z,u.X1,y.G,g.i,v.uc,C.fS,m.Hl,Q.h_]})}return t})()},8655:(M,h,r)=>{r.d(h,{U:()=>g});var p=r(3953),u=r(1626),y=r(1441);let g=(()=>{class v{constructor(m,e){this.http=m,this.appConfig=e,this.url=this.appConfig.defaultUrl}GetEmployee(m,e,d="ar-LY"){const f={culture:d};return m&&(f.SearchType=m),e&&(f.Value=e),this.http.get(`${this.url}/api/Employee/GetAllEmployee`,{params:f})}GetEmployeeSmallObject(m,e="ar-LY"){const d={culture:e};return m&&(d.Name=m),this.http.get(`${this.url}/api/Employee/GetEmployees`,{params:d})}static#e=this.\u0275fac=function(e){return new(e||v)(p.KVO(u.Qq),p.KVO(y.o))};static#a=this.\u0275prov=p.jDH({token:v,factory:v.\u0275fac,providedIn:"root"})}return v})()}}]);